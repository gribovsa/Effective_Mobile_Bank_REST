# Здесь будет OpenAPI описание всех доступных эндпоинтов и моделей данных.
openapi: 3.0.3
info:
  title: Bank Card Management API
  version: 1.0.0
  description: |
    Полная документация REST API для управления банковскими картами, пользователями и авторизацией JWT.
    Роли:
      - USER: базовые операции с картами (просмотр, перевод, запрос блокировки);
      - ADMIN: управление пользователями и всеми картами.
servers:
  - url: http://localhost:8081
paths:
  /api/auth/register:
    post:
      summary: Регистрация нового пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: JWT токен
          content:
            application/json:
              schema:
                type: string
        '400':
          description: Неверные данные пользователя
          content:
            application/json:
              schema:
                type: string
  /api/auth/login:
    post:
      summary: Аутентификация пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginDTO'
            example:
              username: admin_user
              password: passwordAdmin
      responses:
        '200':
          description: JWT токен
          content:
            application/json:
              schema:
                type: string
        '401':
          description: Неверные учетные данные
          content:
            application/json:
              schema:
                type: string
                example: Invalid credentials
  /api/user/cards:
    get:
      summary: Получение карт текущего пользователя
      parameters:
        - in: query
          name: search
          required: false
          schema:
            type: string
          description: Поиск по номеру карты
        - in: query
          name: page
          schema:
            type: integer
            default: 0
          description: Номер страницы
        - in: query
          name: size
          schema:
            type: integer
            default: 10
          description: Размер страницы
      responses:
        '200':
          description: Список карт
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageCardDTO'
      security:
        - bearerAuth: []
  /api/user/transfer:
    post:
      summary: Перевод между картами пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferRequestDTO'
      responses:
        '200':
          description: Успешный перевод
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Неверные данные или недостаточно средств
          content:
            application/json:
              schema:
                type: string
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/cards/{cardId}/block:
    post:
      summary: Запрос на блокировку карты (пользователь)
      parameters:
        - in: path
          name: cardId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Карта заблокирована
          content:
            application/json:
              schema:
                type: object
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Карта не найдена
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/cards/{cardId}/balance:
    get:
      summary: Получение баланса карты
      parameters:
        - in: path
          name: cardId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Баланс карты
          content:
            application/json:
              schema:
                type: number
                format: double
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Карта не найдена
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/admin/cards:
    get:
      summary: Получение всех карт (админ)
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
          description: Номер страницы
        - in: query
          name: size
          schema:
            type: integer
            default: 10
          description: Размер страницы
      responses:
        '200':
          description: Список всех карт
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageCardDTO'
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
    post:
      summary: Создание новой карты (админ)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardCreateDTO'
            example:
              ownerUsername: regular_user
              expiryDate: 2028-07-12
              initialBalance: 1000
      responses:
        '200':
          description: Карта создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardDTO'
        '400':
          description: Неверные данные
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/admin/cards/{cardId}/activate:
    put:
      summary: Активация карты (админ)
      parameters:
        - in: path
          name: cardId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Карта активирована
          content:
            application/json:
              schema:
                type: object
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Карта не найдена
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/admin/cards/{cardId}/block:
    put:
      summary: Блокировка карты (админ)
      parameters:
        - in: path
          name: cardId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Карта заблокирована
          content:
            application/json:
              schema:
                type: object
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Карта не найдена
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/admin/cards/{cardId}:
    delete:
      summary: Удаление карты (админ)
      parameters:
        - in: path
          name: cardId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Карта удалена
          content:
            application/json:
              schema:
                type: object
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Карта не найдена
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/admin/users:
    get:
      summary: Получение списка пользователей (с фильтрацией по username)
      parameters:
        - in: query
          name: username
          required: false
          schema:
            type: string
          description: Поиск по имени пользователя
        - in: query
          name: page
          schema:
            type: integer
            default: 0
          description: Номер страницы
        - in: query
          name: size
          schema:
            type: integer
            default: 10
          description: Размер страницы
      responses:
        '200':
          description: Список пользователей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageUserDTO'
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
    post:
      summary: Создание нового пользователя (админ)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: Пользователь создан
          content:
            application/json:
              schema:
                type: string
        '400':
          description: Неверные данные
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/admin/users/{userId}:
    delete:
      summary: Удаление пользователя по ID (админ)
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Пользователь удалён
          content:
            application/json:
              schema:
                type: object
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/admin/users/{userId}/password:
    put:
      summary: Обновление пароля пользователя (админ)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordUpdateDTO'
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Пароль обновлён
          content:
            application/json:
              schema:
                type: string
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
  /api/admin/users/{userId}/role:
    put:
      summary: Обновление роли пользователя (админ)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleUpdateDTO'
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Роль обновлена
          content:
            application/json:
              schema:
                type: string
        '403':
          description: Доступ запрещён
          content:
            application/json:
              schema:
                type: string
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        role:
          type: string
          enum: [ USER, ADMIN ]
        username:
          type: string
        password:
          type: string
      required:
        - username
        - password
    LoginDTO:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required:
        - username
        - password
    CardCreateDTO:
      type: object
      properties:
        ownerUsername:
          type: string
        expiryDate:
          type: string
          format: date
        initialBalance:
          type: number
          format: double
      required:
        - ownerUsername
        - expiryDate
        - initialBalance
    CardDTO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        maskedCardNumber:
          type: string
        ownerUsername:
          type: string
        expiryDate:
          type: string
          format: date
        status:
          type: string
          enum: [ACTIVE, BLOCKED, EXPIRED]
        balance:
          type: number
          format: double
      required:
        - id
        - maskedCardNumber
        - ownerUsername
        - expiryDate
        - status
        - balance
    TransferRequestDTO:
      type: object
      properties:
        fromCardId:
          type: integer
          format: int64
        toCardId:
          type: integer
          format: int64
        amount:
          type: number
          format: double
      required:
        - fromCardId
        - toCardId
        - amount
    UserDTO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        username:
          type: string
        role:
          type: string
          enum: [USER, ADMIN]
        cards:
          type: array
          items:
            $ref: '#/components/schemas/CardDTO'
      required:
        - id
        - username
        - role
    PasswordUpdateDTO:
      type: object
      properties:
        password:
          type: string
          minLength: 4
      required:
        - password
    RoleUpdateDTO:
      type: object
      properties:
        role:
          type: string
          enum: [USER, ADMIN]
      required:
        - role
    PageCardDTO:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/CardDTO'
        pageable:
          type: object
          properties:
            pageNumber:
              type: integer
            pageSize:
              type: integer
            sort:
              type: object
              properties:
                sorted:
                  type: boolean
                unsorted:
                  type: boolean
                empty:
                  type: boolean
            offset:
              type: integer
              format: int64
            paged:
              type: boolean
            unpaged:
              type: boolean
        totalPages:
          type: integer
        totalElements:
          type: integer
          format: int64
        last:
          type: boolean
        numberOfElements:
          type: integer
        size:
          type: integer
        number:
          type: integer
        first:
          type: boolean
        empty:
          type: boolean
      required:
        - content
        - pageable
        - totalPages
        - totalElements
        - last
        - numberOfElements
        - size
        - number
        - first
        - empty
    PageUserDTO:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/UserDTO'
        pageable:
          type: object
          properties:
            pageNumber:
              type: integer
            pageSize:
              type: integer
            sort:
              type: object
              properties:
                sorted:
                  type: boolean
                unsorted:
                  type: boolean
                empty:
                  type: boolean
            offset:
              type: integer
              format: int64
            paged:
              type: boolean
            unpaged:
              type: boolean
        totalPages:
          type: integer
        totalElements:
          type: integer
          format: int64
        last:
          type: boolean
        numberOfElements:
          type: integer
        size:
          type: integer
        number:
          type: integer
        first:
          type: boolean
        empty:
          type: boolean
      required:
        - content
        - pageable
        - totalPages
        - totalElements
        - last
        - numberOfElements
        - size
        - number
        - first
        - empty